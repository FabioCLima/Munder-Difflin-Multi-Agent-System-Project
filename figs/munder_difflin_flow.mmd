---
config:
  theme: neo
  look: neo
---
---
config:
  theme: neo
  look: neo
---
graph TB
    %% Estilos
    classDef customerStyle fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef orchestratorStyle fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    classDef agentStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    classDef toolStyle fill:#ffccbc,stroke:#d84315,stroke-width:1px
    classDef dbStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef processStyle fill:#b2dfdb,stroke:#00695c,stroke-width:2px,stroke-dasharray: 5 5
    
    %% NÃ³s principais
    Customer[ğŸ‘¤ Customer Request]
    Orchestrator[ğŸ­ ORCHESTRATOR AGENT<br/>Router & Coordinator]
    
    %% Agentes
    InventoryAgent[ğŸ“¦ INVENTORY AGENT<br/>Stock Management]
    QuotingAgent[ğŸ’° QUOTING AGENT<br/>Price Calculation]
    SalesAgent[ğŸ¤ SALES AGENT<br/>Order Fulfillment]
    
    %% Process
    ReorderProcess[ğŸ”„ REORDERING AGENT<br/>Auto-triggered]
    
    %% === INVENTORY AGENT TOOLS (EXACT FUNCTION NAMES) ===
    GetAllInventory[ğŸ” get_all_inventory<br/>Returns dict of all items with stock > 0]
    GetStockLevel[ğŸ“Š get_stock_level<br/>Returns DataFrame with specific item stock]
    
    %% === QUOTING AGENT TOOLS (EXACT FUNCTION NAMES) ===
    SearchQuoteHistory[ğŸ“š search_quote_history<br/>Find similar quotes by keywords]
    GetItemPrice[ğŸ’µ Query inventory.unit_price<br/>Get base price from inventory table]
    CalculateBulkDiscount[ğŸ§® Custom Logic<br/>Apply bulk discount based on order_size]
    
    %% === SALES AGENT TOOLS (EXACT FUNCTION NAMES) ===
    CreateTransactionSales[âœ… create_transaction<br/>type='sales' - records customer purchase]
    GetCashBalance[ğŸ’° get_cash_balance<br/>Calculate current cash from transactions]
    GenerateFinancialReport[ğŸ“Š generate_financial_report<br/>Complete financial status report]
    
    %% === REORDERING AGENT TOOLS (EXACT FUNCTION NAMES) ===
    CreateTransactionStock[ğŸ“¥ create_transaction<br/>type='stock_orders' - records supplier purchase]
    GetSupplierDeliveryDate[ğŸ“… get_supplier_delivery_date<br/>Calculate supplier delivery ETA]
    CheckLowStock[âš ï¸ Custom Logic<br/>Compare current_stock vs min_stock_level]
    
    %% Database
    Database[(ğŸ—„ï¸ SQLite Database<br/>munder_difflin.db<br/><br/>Tables:<br/>â€¢ inventory<br/>â€¢ transactions<br/>â€¢ quotes<br/>â€¢ quote_requests)]
    
    %% Response
    Response[ğŸ“¤ Response to Customer]
    
    %% ========= FLUXO PRINCIPAL =========
    Customer -->|Text Request| Orchestrator
    
    Orchestrator -->|Inventory Query| InventoryAgent
    Orchestrator -->|Quote Request| QuotingAgent
    Orchestrator -->|Purchase Order| SalesAgent
    
    %% ========= INVENTORY AGENT FLOW =========
    InventoryAgent --> GetAllInventory
    InventoryAgent --> GetStockLevel
    GetAllInventory --> Database
    GetStockLevel --> Database
    
    %% ========= QUOTING AGENT FLOW =========
    QuotingAgent --> SearchQuoteHistory
    QuotingAgent --> GetItemPrice
    QuotingAgent --> CalculateBulkDiscount
    QuotingAgent -.->|Validate Stock| InventoryAgent
    SearchQuoteHistory --> Database
    GetItemPrice --> Database
    
    %% ========= SALES AGENT FLOW =========
    SalesAgent --> CreateTransactionSales
    SalesAgent --> GetCashBalance
    SalesAgent --> GenerateFinancialReport
    SalesAgent -.->|Validate Availability| InventoryAgent
    CreateTransactionSales --> Database
    GetCashBalance --> Database
    GenerateFinancialReport --> Database
    SalesAgent -.->|Trigger After Sale| ReorderProcess
    
    %% ========= REORDERING AGENT FLOW =========
    ReorderProcess --> CheckLowStock
    ReorderProcess --> CreateTransactionStock
    ReorderProcess --> GetSupplierDeliveryDate
    ReorderProcess --> GetCashBalance
    CheckLowStock --> Database
    CreateTransactionStock --> Database
    
    %% ========= RETURN FLOW =========
    InventoryAgent --> Orchestrator
    QuotingAgent --> Orchestrator
    SalesAgent --> Orchestrator
    Orchestrator --> Response
    Response --> Customer
    
    %% Aplicar estilos
    class Customer customerStyle
    class Orchestrator orchestratorStyle
    class InventoryAgent,QuotingAgent,SalesAgent agentStyle
    class GetAllInventory,GetStockLevel,SearchQuoteHistory,GetItemPrice,CalculateBulkDiscount,CreateTransactionSales,GetCashBalance,GenerateFinancialReport,CreateTransactionStock,GetSupplierDeliveryDate,CheckLowStock toolStyle
    class Database dbStyle
    class ReorderProcess processStyle
    class Response customerStyle